---
- hosts: all
  become: true
  tasks:
    - name: Add tlp repository
      shell: dnf install https://repo.linrunner.de/fedora/tlp/repos/releases/tlp-release.fc$(rpm -E %fedora).noarch.rpm
    
    - name: Install TLP
      dnf:
        name:
          - tlp
          - tlp-pd
          - tlp-rdw
        state: present

    - name: Remove tuned and tuned-ppd
      dnf:
        name:
          - tuned
          - tuned-ppd
        state: absent

    - name: Enable and start TLP service
      systemd:
        name: 
          - tlp.service
          - tlp-pd.service
        enabled: true
        state: started
    
    - name: Mask conflicting services
      systemd:
        name:
          - systemd-rfkill.service
          - systemd-rfkill.socket
        masked: true
    